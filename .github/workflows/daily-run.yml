name: Daily Run

on:
    workflow_dispatch:
    schedule:
        - cron: "0 12 * * *" # 5 AM PT (12:00 UTC)

jobs:
    run:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3

            - name: Set up Node
              uses: actions/setup-node@v4
              with:
                  node-version: "20"

            - name: Install server dependencies
              working-directory: leetcode-notion-automation/server
              run: |
                  npm ci

            - name: Build TypeScript
              working-directory: leetcode-notion-automation/server
              run: |
                  npx tsc -p .

            - name: Run automation (adjust as needed)
              working-directory: leetcode-notion-automation/server
              run: |
                  node dist/server.js & sleep 10 && curl -sS http://localhost:5050/update || true
                  pkill -f "node dist/server.js" || true
